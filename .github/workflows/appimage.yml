name: Release Appimage
#concurrency:
  #group: build-${{ github.ref }}
  #cancel-in-progress: true

on:
  push:
    branches: [ "trunk" ]
    paths:
      - '.github/workflows/appimage.yml'
      - 'AppRun'
  pull_request:
    branches: [ "trunk" ]
    paths:
      - '.github/workflows/appimage.yml'
      - 'AppRun'

jobs:
  # Label of the container job
  build-appimage:
    # Containers must run in Linux based operating systems
    runs-on: ubuntu-latest
    # Docker Hub image that `container-job` executes in
    container: andy5995/0ad-build-appimage:testing
    env:
      VERSION: 0.0.26-alpha
      NAME: 0ad
      ARCH: x86_64
      WORKSPACE: ${{ github.workspace }}
    steps:
    - uses: actions/checkout@v3
    - run: ./workflow.sh

    - name: Release AppImage
      if: ${{ github.ref == 'refs/heads/trunk' }}
      uses: ncipollo/release-action@v1
      with:
        name: ${{ env.NAME }}-${{ env.VERSION }} AppImage
        allowUpdates: True
        prerelease: False
        artifacts: "${{ env.env.WORKSPACE }}/${{ env.NAME }}*.AppImage*"
        token: ${{ secrets.GITHUB_TOKEN }}
        omitNameDuringUpdate: False
        omitBodyDuringUpdate: False
        tag: v${{ env.VERSION }}
        replacesArtifacts: true
    - name: Upload Artifacts
      if: ${{ github.ref != 'refs/heads/trunk' }}
      uses: actions/upload-artifact@v3
      with:
        name: AppImage
        path: ${{ env.WORKSPACE }}/${{ env.NAME }}*.AppImage*



